{"version":3,"file":"sustainability-workspace-view-BAesFlx-.js","sources":["../../../assets/src/documents/views/sustainability-workspace-view.ts"],"sourcesContent":["import { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\r\nimport { html, LitElement, customElement, css, state, repeat } from '@umbraco-cms/backoffice/external/lit'\r\nimport { UMB_WORKSPACE_CONTEXT } from \"@umbraco-cms/backoffice/workspace\";\r\nimport type { UmbDocumentWorkspaceContext } from '@umbraco-cms/backoffice/document';\r\nimport SustainabilityContext, { SUSTAINABILITY_CONTEXT } from \"../../context/sustainability.context\";\r\nimport { ExternalResourceGroup, SustainabilityResponse } from \"../../api\";\r\n\r\n@customElement('sustainability-workspace-view')\r\nexport class SustainabilityWorkspaceElement extends UmbElementMixin(LitElement) {\r\n\r\n  #sustainabilityContext?: SustainabilityContext;\r\n\r\n  @state()\r\n  private _documentUnique?: string = '';\r\n\r\n  @state()\r\n  waiting?: boolean = false;\r\n\r\n  @state()\r\n  pageData?: SustainabilityResponse | undefined = undefined;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(UMB_WORKSPACE_CONTEXT, (nodeContext) => {\r\n      const workspaceContext = (nodeContext as UmbDocumentWorkspaceContext);\r\n\r\n      this.observe((workspaceContext).unique, (unique) => {\r\n        this._documentUnique = unique;\r\n      });\r\n    });\r\n\r\n    this.consumeContext(SUSTAINABILITY_CONTEXT, (instance) => {\r\n      this.#sustainabilityContext = instance;\r\n    });\r\n  }\r\n\r\n  async connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    if (this.#sustainabilityContext != null) {\r\n      if (this._documentUnique) {\r\n        this.pageData = await this.#sustainabilityContext.getPageData(this._documentUnique);\r\n      }\r\n    }\r\n  }\r\n\r\n  async checkPage() {\r\n    this.waiting = true;\r\n    if (this._documentUnique) {\r\n      this.pageData = await this.#sustainabilityContext?.checkPage(this._documentUnique, false);\r\n      this.waiting = false;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.pageData === undefined) {\r\n      return html`\r\n          <uui-box headline=\"Loading sustainability report...\">\r\n              <p>It looks like you haven't run a report on this page yet. Click the button below to get started.</p>\r\n              <uui-button label=\"Run sustainability report\" look=\"primary\" @click=${this.checkPage} .state=${this.waiting ? \"waiting\" : undefined}>\r\n                Run sustainability report\r\n              </uui-button>\r\n          </uui-box>\r\n      `;\r\n    }\r\n    else {\r\n      return html`\r\n            <div class=\"container\">\r\n              ${repeat(\r\n        this.pageData?.resourceGroups!,\r\n        (group) => group.name,\r\n        (group) => this.#renderResourceGroup(group)\r\n      )}\r\n            </div>\r\n            <div class=\"container\">\r\n              <uui-box headline=\"Carbon rating\">\r\n                <sustainability-carbon-rating slot=\"header\" .carbonRating=${this.pageData?.carbonRating}></sustainability-carbon-rating>\r\n                <p><strong>Last tested:</strong> ${new Intl.DateTimeFormat('en-GB', { dateStyle: \"long\", timeStyle: \"short\" }).format(new Date(this.pageData?.lastRunDate!))}</p>\r\n                <uui-button label=\"Run again\" look=\"primary\" @click=${this.checkPage} .state=${this.waiting ? \"waiting\" : undefined}>\r\n                  Run again\r\n                </uui-button>\r\n              </uui-box>\r\n              <uui-box headline=\"Page size\">\r\n                ${(this.pageData!.totalSize / 1024).toFixed(2)}KB\r\n              </uui-box>\r\n              <uui-box headline=\"COâ‚‚ per page view\">\r\n                ${this.pageData?.totalEmissions.toFixed(4)}g\r\n              </uui-box>\r\n            </div>\r\n          `;\r\n    }\r\n  }\r\n\r\n  #renderResourceGroup(group: ExternalResourceGroup) {\r\n    if (group.resources?.length !== 0) {\r\n      return html`\r\n          <uui-box headline=${group.name!}>\r\n            <ul>\r\n            ${repeat(\r\n        group.resources!,\r\n        (resource) => resource.url,\r\n        (resource) => html`<li>${resource.url} (${(resource.size / 1024).toFixed(2)}KB)</li>`\r\n      )}\r\n            </ul>\r\n          </uui-box>\r\n        `;\r\n    }\r\n  }\r\n\r\n  static styles = css`\r\n        :host {\r\n            display: grid;\r\n            gap: var(--uui-size-layout-1);\r\n            padding: var(--uui-size-layout-1);\r\n            grid-template-columns: 1fr 350px;\r\n        }\r\n\r\n        div.container {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-layout-1);\r\n        }\r\n    `\r\n}\r\n\r\nexport default SustainabilityWorkspaceElement;\r\n"],"names":["_sustainabilityContext","_renderResourceGroup","renderResourceGroup_fn","SustainabilityWorkspaceElement","UmbElementMixin","LitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","nodeContext","workspaceContext","unique","SUSTAINABILITY_CONTEXT","instance","__privateSet","__privateGet","_a","html","repeat","group","__privateMethod","_b","_c","_d","resource","css","__decorateClass","state","customElement","SustainabilityWorkspaceElement$1"],"mappings":"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"}