{"version":3,"file":"sustainability-workspace-view-BpmM5whG.js","sources":["../../../assets/src/documents/views/sustainability-workspace-view.ts"],"sourcesContent":["import { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\nimport { html, LitElement, customElement, css, state, property, repeat } from '@umbraco-cms/backoffice/external/lit'\nimport { UMB_WORKSPACE_CONTEXT, UmbVariantableWorkspaceContextInterface } from \"@umbraco-cms/backoffice/workspace\";\nimport SustainabilityManagementContext, { SUSTAINABILITY_MANAGEMENT_CONTEXT_TOKEN } from \"../../context/sustainability.context\";\nimport { ExternalResourceGroup, SustainabilityResponse } from \"@api\";\nimport type { UmbDocumentWorkspaceContext } from '@umbraco-cms/backoffice/document';\n\n@customElement('sustainability-workspace-view')\nexport class SustainabilityWorkspaceElement extends UmbElementMixin(LitElement) {\n\n  #sustainabilityContext?: SustainabilityManagementContext;\n\n  @state()\n  private _documentUnique?: string = '';\n\n  @state()\n  pageName?: string = '';\n\n  @property({ type: Boolean })\n  loading?: boolean = true;\n\n  @property({ type: Boolean })\n  waiting?: boolean = false;\n\n  @property({ type: Object })\n  pageData?: SustainabilityResponse;\n\n  constructor() {\n    super();\n\n    this.consumeContext(UMB_WORKSPACE_CONTEXT, (nodeContext) => {\n\n      const workspaceContext = (nodeContext as UmbDocumentWorkspaceContext);\n\n      this.observe((workspaceContext).unique, (unique) => {\n        this._documentUnique = unique;\n      });\n\n      const variantContext = (nodeContext as UmbVariantableWorkspaceContextInterface);\n      console.log(variantContext.getName());\n\n      this.pageName = variantContext.getName();\n    });\n\n    this.consumeContext(SUSTAINABILITY_MANAGEMENT_CONTEXT_TOKEN, (_instance) => {\n      this.#sustainabilityContext = _instance;\n\n      this.observe(_instance.pageData, (_pageData) => {\n        this.pageData = _pageData;\n        if (this.pageData != null) {\n          if (typeof this.pageData?.totalSize !== \"undefined\") {\n            this.loading = false;\n          }\n        }\n      })\n    })\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n\n    if (this.#sustainabilityContext != null) {\n      if (this.loading) {\n        if (this._documentUnique) {\n          this.#sustainabilityContext.getPageData(this._documentUnique);\n        }\n      }\n    }\n  }\n\n  async checkPage() {\n    this.waiting = true;\n    if (this._documentUnique) {\n      await this.#sustainabilityContext?.checkPage(this._documentUnique, false);\n      this.waiting = false;\n    }\n  }\n\n  render() {\n    if (this.loading) {\n      return html`\n          <uui-box headline=\"Loading sustainability report...\">\n              <p>It looks like you haven't run a report on this page yet. Click the button below to get started.</p>\n              <uui-button look=\"primary\" @click=${this.checkPage} .state=${this.waiting ? \"waiting\" : undefined}>\n                Run sustainability report\n              </uui-button>\n          </uui-box>\n      `;\n    }\n    else {\n      return html`\n            <div class=\"container\">\n              ${repeat(\n        this.pageData?.resourceGroups!,\n        (group) => group.name,\n        (group) => this.#renderResourceGroup(group)\n      )}\n            </div>\n            <div class=\"container\">\n              <uui-box headline=\"Sustainability report\">\n                <p><strong>Last tested:</strong> ${new Intl.DateTimeFormat('en-GB', { dateStyle: \"long\", timeStyle: \"short\" }).format(new Date(this.pageData?.lastRunDate!))}</p>\n                <uui-button look=\"primary\" @click=${this.checkPage} .state=${this.waiting ? \"waiting\" : undefined}>\n                  Run again\n                </uui-button>\n              </uui-box>\n              <uui-box headline=\"Page size\">\n                ${(this.pageData!.totalSize / 1024).toFixed(2)}KB\n              </uui-box>\n              <uui-box headline=\"COâ‚‚ per page view\">\n                ${this.pageData?.totalEmissions.toFixed(4)}g\n              </uui-box>\n            </div>\n          `;\n    }\n  }\n\n  #renderResourceGroup(group: ExternalResourceGroup) {\n    if (group.resources?.length !== 0) {\n      return html`\n          <uui-box headline=${group.name!}>\n            <ul>\n            ${repeat(\n        group.resources!,\n        (resource) => resource.url,\n        (resource) => html`<li>${resource.url} (${(resource.size / 1024).toFixed(2)}KB)</li>`\n      )}\n            </ul>\n          </uui-box>\n        `;\n    }\n  }\n\n  static styles = css`\n        :host {\n            display: grid;\n            gap: var(--uui-size-layout-1);\n            padding: var(--uui-size-layout-1);\n            grid-template-columns: 1fr 350px;\n        }\n\n        div.container {\n            display: flex;\n            flex-direction: column;\n            gap: var(--uui-size-layout-1);\n        }\n    `\n}\n\nexport default SustainabilityWorkspaceElement;\n"],"names":["_sustainabilityContext","_renderResourceGroup","renderResourceGroup_fn","SustainabilityWorkspaceElement","UmbElementMixin","LitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","nodeContext","workspaceContext","unique","variantContext","SUSTAINABILITY_MANAGEMENT_CONTEXT_TOKEN","_instance","__privateSet","_pageData","_a","__privateGet","html","repeat","group","__privateMethod","_b","_c","resource","css","__decorateClass","state","property","customElement","SustainabilityWorkspaceElement$1"],"mappings":"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"}