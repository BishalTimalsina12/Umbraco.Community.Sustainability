{"version":3,"file":"sustainability-workspace-view-Cfy57THM.js","sources":["../../../assets/src/documents/views/sustainability-workspace-view.ts"],"sourcesContent":["import { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\r\nimport { html, LitElement, customElement, css, state, property, repeat } from '@umbraco-cms/backoffice/external/lit'\r\nimport { UMB_WORKSPACE_CONTEXT, UmbVariantableWorkspaceContextInterface } from \"@umbraco-cms/backoffice/workspace\";\r\nimport type { UmbDocumentWorkspaceContext } from '@umbraco-cms/backoffice/document';\r\nimport SustainabilityContext, { SUSTAINABILITY_CONTEXT } from \"../../context/sustainability.context\";\r\nimport { ExternalResourceGroup, SustainabilityResponse } from \"../../api\";\r\n\r\n@customElement('sustainability-workspace-view')\r\nexport class SustainabilityWorkspaceElement extends UmbElementMixin(LitElement) {\r\n\r\n  #sustainabilityContext?: SustainabilityContext;\r\n\r\n  @state()\r\n  private _documentUnique?: string = '';\r\n\r\n  @state()\r\n  pageName?: string = '';\r\n\r\n  @property({ type: Boolean })\r\n  loading?: boolean = true;\r\n\r\n  @property({ type: Boolean })\r\n  waiting?: boolean = false;\r\n\r\n  @property({ type: Object })\r\n  pageData?: SustainabilityResponse;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(UMB_WORKSPACE_CONTEXT, (nodeContext) => {\r\n\r\n      const workspaceContext = (nodeContext as UmbDocumentWorkspaceContext);\r\n\r\n      this.observe((workspaceContext).unique, (unique) => {\r\n        this._documentUnique = unique;\r\n      });\r\n\r\n      const variantContext = (nodeContext as UmbVariantableWorkspaceContextInterface);\r\n      console.log(variantContext.getName());\r\n\r\n      this.pageName = variantContext.getName();\r\n    });\r\n\r\n    this.consumeContext(SUSTAINABILITY_CONTEXT, (instance) => {\r\n      this.#sustainabilityContext = instance;\r\n\r\n      this.observe(instance.pageData, (_pageData) => {\r\n        this.pageData = _pageData;\r\n        if (this.pageData != null) {\r\n          if (typeof this.pageData?.totalSize !== \"undefined\") {\r\n            this.loading = false;\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  connectedCallback(): void {\r\n    super.connectedCallback();\r\n\r\n    if (this.#sustainabilityContext != null) {\r\n      if (this.loading) {\r\n        if (this._documentUnique) {\r\n          this.#sustainabilityContext.getPageData(this._documentUnique);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  async checkPage() {\r\n    this.waiting = true;\r\n    if (this._documentUnique) {\r\n      await this.#sustainabilityContext?.checkPage(this._documentUnique, false);\r\n      this.waiting = false;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.loading) {\r\n      return html`\r\n          <uui-box headline=\"Loading sustainability report...\">\r\n              <p>It looks like you haven't run a report on this page yet. Click the button below to get started.</p>\r\n              <uui-button label=\"Run sustainability report\" look=\"primary\" @click=${this.checkPage} .state=${this.waiting ? \"waiting\" : undefined}>\r\n                Run sustainability report\r\n              </uui-button>\r\n          </uui-box>\r\n      `;\r\n    }\r\n    else {\r\n      return html`\r\n            <div class=\"container\">\r\n              ${repeat(\r\n        this.pageData?.resourceGroups!,\r\n        (group) => group.name,\r\n        (group) => this.#renderResourceGroup(group)\r\n      )}\r\n            </div>\r\n            <div class=\"container\">\r\n              <uui-box headline=\"Sustainability report\">\r\n                <p><strong>Last tested:</strong> ${new Intl.DateTimeFormat('en-GB', { dateStyle: \"long\", timeStyle: \"short\" }).format(new Date(this.pageData?.lastRunDate!))}</p>\r\n                <uui-button label=\"Run again\" look=\"primary\" @click=${this.checkPage} .state=${this.waiting ? \"waiting\" : undefined}>\r\n                  Run again\r\n                </uui-button>\r\n              </uui-box>\r\n              <uui-box headline=\"Page size\">\r\n                ${(this.pageData!.totalSize / 1024).toFixed(2)}KB\r\n              </uui-box>\r\n              <uui-box headline=\"COâ‚‚ per page view\">\r\n                ${this.pageData?.totalEmissions.toFixed(4)}g\r\n              </uui-box>\r\n            </div>\r\n          `;\r\n    }\r\n  }\r\n\r\n  #renderResourceGroup(group: ExternalResourceGroup) {\r\n    if (group.resources?.length !== 0) {\r\n      return html`\r\n          <uui-box headline=${group.name!}>\r\n            <ul>\r\n            ${repeat(\r\n        group.resources!,\r\n        (resource) => resource.url,\r\n        (resource) => html`<li>${resource.url} (${(resource.size / 1024).toFixed(2)}KB)</li>`\r\n      )}\r\n            </ul>\r\n          </uui-box>\r\n        `;\r\n    }\r\n  }\r\n\r\n  static styles = css`\r\n        :host {\r\n            display: grid;\r\n            gap: var(--uui-size-layout-1);\r\n            padding: var(--uui-size-layout-1);\r\n            grid-template-columns: 1fr 350px;\r\n        }\r\n\r\n        div.container {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-layout-1);\r\n        }\r\n    `\r\n}\r\n\r\nexport default SustainabilityWorkspaceElement;\r\n"],"names":["_sustainabilityContext","_renderResourceGroup","renderResourceGroup_fn","SustainabilityWorkspaceElement","UmbElementMixin","LitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","nodeContext","workspaceContext","unique","variantContext","SUSTAINABILITY_CONTEXT","instance","__privateSet","_pageData","_a","__privateGet","html","repeat","group","__privateMethod","_b","_c","resource","css","__decorateClass","state","property","customElement","SustainabilityWorkspaceElement$1"],"mappings":"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"}